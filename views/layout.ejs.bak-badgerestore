<!DOCTYPE html>
<html lang="es" class="<%= hideTabbar ? 'auth-html' : '' %>">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= title || "Facultad" %></title>
  <link rel="stylesheet" href="/public/css/app.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-slate-50 to-white min-h-screen">
  <% if (hideTabbar) { %><div class="auth-brand">Facultad</div><% } %>

  <div class="max-w-6xl mx-auto px-4 <%= hideTabbar ? 'pb-0' : 'pb-40' %>">
    <% if (!hideTabbar) { %>
    <header class="flex items-center justify-between py-4">
      <div class="text-xl font-semibold">Facultad</div>
      <% if (user) { %>
      <form method="POST" action="/logout">
        <button class="text-sm text-gray-600 hover:underline">Salir</button>
      </form>
      <% } %>
    </header>
    <% } %>

    <main>
      <%- body %>
    </main>
  </div>

  <% if (user && !hideTabbar) { %>
  <!-- Tab bar iOS 2025 (crystal) -->
  <nav class="tabbar-wrap" role="navigation" aria-label="Barra de pestañas">
    <% /* ===== USER BADGE ALINEADO A LA TAB BAR (solo páginas principales) ===== */ %>
    <% if (isMainPage) { 
         const initials = (user.name || 'U').split(' ').slice(0,2).map(s=>s && s[0]).join('').toUpperCase();
    %>
      <div class="user-badge user-badge-inline">
        <div class="avatar">
          <% if (user.avatarUrl) { %>
            <img src="<%= user.avatarUrl %>" alt="Avatar" />
          <% } else { %>
            <span><%= initials %></span>
          <% } %>
        </div>
        <div class="meta">
          <div class="name"><%= user.name || 'Usuario' %></div>
          <div class="sub">
            <% if (user.career && user.plan) { %>
              <%= (user.career.includes('Admin') ? 'Lic. en Admin.' : (user.career.includes('Econom') ? 'Lic. en Economía' : (user.career || ''))) %>
              <%= user.plan ? (' · Plan ' + user.plan) : '' %>
            <% } %>
          </div>
        </div>
      </div>
    <% } %>

    <div class="tabbar crystal">
      <a class="tabbar-item" data-route="/app/materias" href="/app/materias" aria-label="Materias">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 7.5A2.5 2.5 0 0 1 6.5 5H12v14H6.5A2.5 2.5 0 0 1 4 16.5V7.5Z"/>
          <path d="M12 5h5.5A2.5 2.5 0 0 1 20 7.5v9A2.5 2.5 0 0 1 17.5 19H12"/>
        </svg>
        <span>Materias</span>
      </a>
      <a class="tabbar-item" data-route="/app/autoevaluaciones" href="/app/autoevaluaciones" aria-label="Autoevaluaciones">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <rect x="4" y="4" width="16" height="16" rx="5"/>
          <path d="M8.5 12.5l2.5 2.5 5-6.5"/>
        </svg>
        <span>Autoeval</span>
      </a>
      <a class="tabbar-item" data-route="/app/juegos" href="/app/juegos" aria-label="Juegos">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="9" width="18" height="6" rx="3"/>
          <path d="M8 12h-2m1-1v2"/>
          <circle cx="16.5" cy="12" r="1.2"/>
          <circle cx="19" cy="10.5" r="1.2"/>
        </svg>
        <span>Juegos</span>
      </a>
      <a class="tabbar-item" data-route="/app/correlativas" href="/app/correlativas" aria-label="Correlativas">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="6" cy="6.5" r="2.5"/><circle cx="18" cy="6.5" r="2.5"/><circle cx="12" cy="17.5" r="2.5"/>
          <path d="M7.5 8.2 10.7 15M16.5 8.2 13.3 15"/>
        </svg>
        <span>Correl.</span>
      </a>
      <a class="tabbar-item" data-route="/app/finales" href="/app/finales" aria-label="Finales">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z"/>
          <path d="M9 4a3 3 0 0 0 3 3h0a3 3 0 0 0 3-3"/>
          <path d="M8.5 12h7"/>
        </svg>
        <span>Finales</span>
      </a>
      <a class="tabbar-item" data-route="/app/profesores" href="/app/profesores" aria-label="Profesores">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="10" cy="8" r="3.2"/>
          <path d="M17.8 20v-.8a4.8 4.8 0 0 0-4.8-4.8H7a4.8 4.8 0 0 0-4.8 4.8v.8"/>
          <circle cx="18.2" cy="7.2" r="2.2"/>
          <path d="M20.5 20v-.7a3.8 3.8 0 0 0-2.7-3.6"/>
        </svg>
        <span>Profes</span>
      </a>
      <div class="tabbar-indicator" aria-hidden="true"></div>
    </div>
  </nav>
  <% } %>

  <script src="/public/js/app.js"></script>
</body>
</html>
